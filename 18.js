"use strict";

function calc() {
	const list = input.split('\n');

	const part1 = magnitude(list.reduce((a, e) => add(a, e), null));
	
	let maxMagnitude = 0;

	for (let i = 0; i < list.length - 1; ++i) {
		for (let j = i + 1; j < list.length; ++j) {
			maxMagnitude = Math.max(magnitude(add(list[i], list[j])), maxMagnitude);
			maxMagnitude = Math.max(magnitude(add(list[j], list[i])), maxMagnitude);
		}
	}

	const part2 = maxMagnitude;

	return part1 + ' ' + part2;
}

function add(s1, s2) {
	return s1 ? reduce('[' + [s1, s2].join(',') + ']') : s2;
}

function reduce(str) {
	for (let reduced = false; !reduced;) {
		const exploded = explode(str);
		const splitted = split(str);

		if (exploded != str) {
			str = exploded;
		} else if (splitted != str) {
			str = splitted;
		} else {
			reduced = true;
		}
	}

	return str;
}

function explode(str) {
	let exploded = null;

	str = str.replace(/\[\d+,\d+\]/g, (m, ofs) => {
		const level = str.slice(0, ofs).split('')
			.filter(e => e == '[' || e == ']')
			.reduce((a, e) => a + (e == '[' ? 1 :-1), 0);

		if (!exploded && level == 4) {
			exploded = m.match(/\d+/g).map(Number);
			return '*';
		} else {
			return m;
		}
	});

	if (exploded) {
		let [lhs, rhs] = str.split('*');
		lhs = lhs.replace(/\d+(?!.*\d)/, m => +m + exploded[0]);
		rhs = rhs.replace(/\d+/, m => +m + exploded[1]);
		str = [lhs, rhs].join('0');
	}

	return str;
}

function split(str) {
	return str.replace(/\d\d+/, m => 
		'[' + [Math.floor(m / 2), Math.ceil(m / 2)].join(',') + ']');
}

function magnitude(str) {
	while (str.indexOf('[') >= 0) {
		str = str.replace(/\[(\d+),(\d+)\]/g, (_, lhs, rhs) => lhs * 3 + rhs * 2);
	}

	return str;
}

const input = `[2,[[7,4],[5,[3,9]]]]
[[[[1,4],[0,1]],4],[3,[8,5]]]
[[0,[2,8]],[[[3,7],0],[7,[3,1]]]]
[[8,[5,[2,3]]],[[3,[9,2]],[[3,8],[0,2]]]]
[[[1,[3,6]],6],[[[8,7],[2,2]],[7,6]]]
[6,[[[5,7],6],[[7,8],2]]]
[[1,3],[[[0,1],[9,4]],1]]
[[[[0,6],5],7],[7,[[0,7],[9,6]]]]
[[[7,7],4],[[5,7],[[2,3],[4,4]]]]
[[5,[0,[7,3]]],[7,[[6,1],4]]]
[[[8,9],[3,[5,3]]],[[2,8],[[0,8],6]]]
[[[[6,4],[2,5]],[[2,1],[3,3]]],[3,6]]
[6,[[5,[8,3]],[[2,3],[9,1]]]]
[[[[5,6],1],[7,[8,1]]],[2,[7,0]]]
[[[2,4],[[8,8],6]],[[[3,4],[4,5]],[0,[8,5]]]]
[1,[[6,6],[9,1]]]
[[[[6,0],8],[[3,2],[5,8]]],[[6,1],[[6,4],5]]]
[[4,[1,[8,1]]],[7,[4,[0,8]]]]
[[[3,3],[[1,5],[5,2]]],[[[4,5],[8,5]],[[5,8],5]]]
[[[0,4],[[5,0],2]],[[7,[9,3]],5]]
[[[7,[4,4]],[4,5]],[5,2]]
[[[[9,2],[7,4]],[[4,4],9]],[[[2,2],[9,7]],[[8,0],[0,9]]]]
[[[[6,2],3],[4,[6,9]]],5]
[[[8,4],[1,6]],6]
[[1,1],[[[8,9],[5,2]],[1,5]]]
[[[[3,8],5],[6,5]],2]
[[4,[6,8]],[[1,[5,2]],[[6,3],[7,9]]]]
[9,[5,[1,9]]]
[[[[5,2],[4,1]],[[8,6],[4,1]]],[[0,7],[1,8]]]
[[[0,4],[[6,8],[4,8]]],[[0,[7,0]],[6,9]]]
[[[[7,1],[6,1]],[[2,2],[9,9]]],[[[7,1],[5,1]],[[3,0],[9,6]]]]
[[[1,6],[7,[1,6]]],[[1,[7,3]],[[7,4],3]]]
[[[[1,6],[7,0]],[[4,5],2]],4]
[[[7,2],[7,5]],[[8,[1,8]],[[8,5],9]]]
[[[7,8],[[7,5],[8,0]]],[[9,5],0]]
[[[5,2],8],[1,[2,2]]]
[[[[3,1],[2,7]],[8,4]],[[4,[6,1]],2]]
[[4,[7,[7,0]]],5]
[[[7,5],[[1,2],[7,4]]],[[7,[3,9]],9]]
[[[[8,6],[7,1]],8],[[9,7],7]]
[[7,[[9,0],5]],[[[0,9],[7,5]],[[8,1],9]]]
[[[8,9],[[4,2],[3,3]]],[[3,8],2]]
[[[[6,9],1],[8,[9,1]]],[[5,9],[1,5]]]
[[[[8,4],[9,6]],[[9,1],7]],[[0,3],[[6,3],8]]]
[[[[2,0],[3,7]],[[3,4],9]],[0,[[0,5],4]]]
[[3,[3,[5,2]]],[[[1,0],7],1]]
[[[6,7],[0,3]],[6,3]]
[[[[1,1],[6,6]],3],[[8,[6,9]],[5,[1,3]]]]
[[[[3,3],8],5],[[[7,7],[8,2]],[[1,2],7]]]
[6,[[2,4],[4,7]]]
[[[[3,4],[6,2]],8],[[9,7],0]]
[[8,[9,[8,1]]],[4,4]]
[[[[9,8],4],[[3,9],[4,3]]],[[7,[7,4]],3]]
[[2,[3,[3,1]]],[[2,[5,8]],2]]
[[[[1,8],[7,9]],[7,[4,4]]],[9,[[1,9],5]]]
[[[[5,9],[5,8]],[7,[5,6]]],[[[5,4],[7,7]],[[0,4],0]]]
[[[6,[4,3]],6],[[1,[5,0]],[[5,9],[3,5]]]]
[[[[3,5],[9,4]],[7,[2,7]]],8]
[[[8,[7,8]],1],[7,[0,4]]]
[[7,4],[0,0]]
[1,[5,[6,[7,2]]]]
[[[7,[0,5]],[4,3]],[4,[6,5]]]
[[3,[[3,0],[2,8]]],[[[5,7],5],[7,6]]]
[5,[4,[[4,8],[0,3]]]]
[[[3,[5,8]],6],[9,3]]
[[[7,[3,9]],2],[[2,6],[[3,5],[0,2]]]]
[[[[7,6],[4,2]],[[9,2],2]],[[[6,1],8],[[8,8],1]]]
[[[[9,3],1],2],[1,[[7,4],1]]]
[[[[0,1],[1,4]],3],[[[7,6],1],[[2,8],[8,4]]]]
[[[1,[3,5]],5],[0,[[8,4],[7,2]]]]
[[[[0,2],[3,7]],[0,0]],3]
[[[[1,5],[0,0]],[6,[3,7]]],[[9,4],5]]
[[[[9,4],4],5],[[6,[6,4]],1]]
[[1,[3,[5,9]]],[[1,[7,0]],5]]
[[[0,[9,8]],[[4,3],6]],[[[2,3],5],[6,[1,3]]]]
[[1,[7,[9,7]]],[7,[[0,5],[8,9]]]]
[[9,[[6,4],[2,2]]],[9,[[7,5],[6,2]]]]
[[[9,[4,7]],[6,0]],2]
[[7,[[0,9],[3,6]]],[1,[[8,5],0]]]
[[[9,4],[[0,9],[7,7]]],[[[2,8],8],[4,6]]]
[1,[[[5,7],6],2]]
[[5,[6,[6,3]]],[6,[[0,3],6]]]
[[[2,9],[[8,7],0]],[[[7,6],8],[[8,2],4]]]
[0,[[2,3],[4,4]]]
[[[[6,6],[5,4]],5],1]
[[[[5,5],8],0],[9,0]]
[[0,4],[[2,[0,1]],9]]
[[[[7,3],3],4],[[[8,3],[0,9]],[6,9]]]
[[[[3,9],[6,5]],6],[9,2]]
[9,[8,[7,3]]]
[[[6,6],[[3,6],2]],[[[4,6],5],[3,4]]]
[6,[[7,[4,6]],1]]
[[[[1,8],5],[1,0]],9]
[[6,[[8,8],[9,6]]],[6,[8,2]]]
[[8,[7,3]],[[[2,2],[5,8]],8]]
[[[0,[4,3]],[[5,5],0]],[8,[1,[1,2]]]]
[[[[3,7],[5,5]],[1,0]],[4,5]]
[[8,[3,[3,1]]],[[3,4],[[5,4],3]]]
[[[3,[9,9]],[[6,0],[4,5]]],[[9,[3,5]],[[2,8],[6,0]]]]
[[5,[[7,2],5]],5]`;
